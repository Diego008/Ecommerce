@model Ecommerce.Models.Usuario

@{
    ViewBag.Title = "Usuario";
}
<h2>@ViewBag.Title.</h2>
<h3>@ViewBag.Message</h3>

@using (Html.BeginForm("Create", "Usuarios", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{

    @Html.AntiForgeryToken();

    <form class="form-horizontal form-event" name="frMascara">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="row form-group form">
            @Html.LabelFor(model => model.Nome, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })

            <div class="col-sm-10">
                @Html.EditorFor(model => model.Nome, new { htmlAttributes = new { id = "txtNome", @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Nome, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Cpf, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })

            <div class="col-sm-3">
                @Html.EditorFor(model => model.Cpf, new { htmlAttributes = new { id = "txtCpf", @class = "form-control", onkeyup = "mascaraCpf()" } })
                @Html.ValidationMessageFor(model => model.Cpf, "", new { @class = "text-danger" })
            </div>

            @Html.LabelFor(model => model.Rg, htmlAttributes: new { @class = "control-label col-sm-1" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Rg, new { htmlAttributes = new { id = "txtRg", @class = "form-control", onkeyup = "mascaraRg()" } })
                @Html.ValidationMessageFor(model => model.Rg, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Cep, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })

            <div class="col-sm-3">
                @Html.EditorFor(model => model.Cep, new { htmlAttributes = new { id = "txtCep", @class = "form-control", onkeyup = "mascaraCep()" } })
                @Html.ValidationMessageFor(model => model.Cep, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Endereco, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })

            <div class="col-sm-3 inputEnd">
                @Html.EditorFor(model => model.Endereco, new { htmlAttributes = new { id = "txtEnd", @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Endereco, "", new { @class = "text-danger" })
            </div>

            @Html.LabelFor(model => model.Numero, htmlAttributes: new { @class = "control-label col-sm-1" })
            <div class="col-sm-3 inputNum">
                @Html.EditorFor(model => model.Numero, new { htmlAttributes = new { id = "txtNumero", @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Numero, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Bairro, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Bairro, new { htmlAttributes = new { id = "txtBairro", @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Bairro, "", new { @class = "text-danger" })
            </div>
            @Html.LabelFor(model => model.Cidade, htmlAttributes: new { @class = "control-label col-sm-1" })
            <div class="col-sm-3">
                @Html.EditorFor(model => model.Cidade, new { htmlAttributes = new { id = "txtCidade", @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Cidade, "", new { @class = "text-danger" })
            </div>

        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Contato, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })

            <div class="col-sm-3">
                @Html.EditorFor(model => model.Contato, new { htmlAttributes = new { id = "txtContato", @class = "form-control", placeholder = "Ex: (DDD)9999-8888", onkeypress = "mascaraContato(event)" } })
            </div>

            <div class="col-sm-3">
                <input id="btnSalvarContato" type="button" class="btn btn-success" value="+" />
            </div>
        </div>

        <div class="row form-group">
            <div class="col-sm-6 col-sm-offset-2">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Contatos Adicionados</th>
                        </tr>
                    </thead>

                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="row form-group form">
            @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })
            <div class="col-sm-10">
                @Html.EditorFor(model => model.Email, new { htmlAttributes = new { id = "txtEmail", @class = "form-control", @type = "email", placeholder = "Email", required = "required" } })
                @Html.ValidationMessageFor(model => model.Email, "", new{ @class = "text-danger"})
            </div>
        </div>
        <div class="row form-group form">
            @Html.LabelFor(model => model.Senha, htmlAttributes: new { @class = "control-label col-sm-1 col-sm-offset-1" })
            <div class="col-sm-10">
                @Html.EditorFor(model => model.Senha, new { htmlAttributes = new { id = "txtSenha", @class = "form-control", @type = "password", onkeyup = "checkPassword()" } })
                @Html.ValidationMessageFor(model => model.Senha, "", new { @class = "text-danger" })
                <p><label id="strenghPassword" class="control-label"></label></p>
            </div>
        </div>

        <div class="row form-group">
            @Html.LabelFor(model => model.Imagem, htmlAttributes: new {@class = "control-label col-sm-1 col-sm-offset-1" })
            @*@Html.EditorFor(model => model.Imagem, new { htmlAttributes = new { @type = "file", id = "txtImagem", @class = "input-file" } })*@
            <input type="file" class="form-control" id="txtImagem" />
            @if (ViewBag.MessageFoto != null)
            {
                <span class="text-danger">
                    @ViewBag.MessageFoto
                </span>
            }
        </div>

        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <input type="submit" class="btn btn-primary" value="Cadastrar" onclick="SaveUser()" />
                @*<input type="submit" class="btn btn-primary" value="Cadastrar">*@
            </div>
        </div>
       
    </form>
}

@section scripts{  
      
<script src="~/Scripts/MeuScript.js" type="text/javascript"></script>
    <script>
        var campos = [
            document.querySelector("#txtContato")
        ];

        console.log(campos);

        var tbody = document.querySelector('table tbody');

        var el = document.querySelector("#btnSalvarContato");
        if (el) {
            el.addEventListener('click', function (event) {
                event.preventDefault();

                var tr = document.createElement('tr');
                var tdCheck = document.createElement('input');

                tdCheck.setAttribute("type", "checkbox");
                tr.appendChild(tdCheck);
                campos.forEach(function (campo) {
                    var td = document.createElement('td');
                    td.textContent = campo.value;
                    td.className = "contatos";                    
                    tr.appendChild(td);
                });

                var tdExcluir = document.createElement('td');
                var btExcluir = document.createElement('input');
                btExcluir.setAttribute('type', 'button');
                btExcluir.value = 'Excluir';
                btExcluir.className = 'btn btn-success';

                tdExcluir.appendChild(btExcluir);
                tdExcluir.style.width = '200px';
                tr.appendChild(tdExcluir);

                tbody.appendChild(tr);

                campos[0].value = '';                

                btExcluir.onclick = function () {
                    if (!tdCheck.checked) {
                        alert('Marque a checkbox');
                    } else {
                        var opcao = confirm('Tem certeza que deseja excluir esta Linha?');

                        if (opcao == true) {
                            tbody.removeChild(tr);
                        }
                    }
                }
            });
        }
    </script>

    <script>        
        function SaveUser() {
            var usuario = new Object();

            usuario.Nome = document.getElementById("txtNome").value;
            usuario.Cpf = document.getElementById("txtCpf").value;
            usuario.Rg = document.getElementById("txtRg").value;
            usuario.Cep = document.getElementById("txtCep").value;
            usuario.Endereco = document.getElementById("txtEnd").value;
            usuario.Numero = document.getElementById("txtNumero").value;
            usuario.Bairro = document.getElementById("txtBairro").value;
            usuario.Cidade = document.getElementById("txtCidade").value;            

            var array = new Array();
            var tds = document.getElementsByClassName("contatos");

            for (var i = 0; i < tds.length; i++) {
                array.push(tds[i].innerHTML);                
            }
            document.getElementById("txtContato").value = array.toString();
            usuario.Contato = document.getElementById("txtContato").value;
            usuario.Email = document.getElementById("txtEmail").value;
            usuario.Senha = document.getElementById("txtSenha").value;            
                        
            //enviando dados para controller
            var dataJson = JSON.stringify(usuario);
            $.ajax({
                type: "POST",
                traditional: true,
                url: '@Url.Action("Create", "Usuarios")',
                datatype: "json",
                data: { data: dataJson }
            });            
            
        }
        
    </script>

    <script>
        function checkPassword() {
            var password = document.getElementById("txtSenha").value;

            if (password.length == 0) {
                document.getElementById("strenghPassword").innerHtml = "";
            } else if (password.length <= 6) {
                document.getElementById("strenghPassword").innerHTML = "Senha Fraca";
                document.getElementById("strenghPassword").className = "label label-danger";
            } else {
                document.getElementById("strenghPassword").innerHTML = "Senha Forte";
                document.getElementById("strenghPassword").className = "label label-success";
            }
        }
    </script>
}




